import { Component, OnInit, ViewEncapsulation } from '@angular/core';
import { FormBuilder, FormControl, FormGroup, Validators } from '@angular/forms';
import { Router } from '@angular/router';
import { TooltipPosition } from '@ng-matero/extensions';
import { CommonService } from 'src/app/_services/common.service';
import { NotificationsService } from 'src/app/_services/notifications.service';

import { environment } from 'src/environments/environment';
declare var $:any
@Component({
  selector: 'app-walkthrogh',
  templateUrl: './walkthrogh.component.html',
  styleUrls: ['./walkthrogh.component.scss'],
  encapsulation: ViewEncapsulation.None,
})
export class WalkthroghComponent implements OnInit {
  positionOptions: TooltipPosition[] = ['below', 'above', 'left', 'right'];
  position = new FormControl(this.positionOptions[1]);
  imgurl: string;
  userInfo: any;
imgUrl=environment.homeURL
  splash: any;
  SplashUpdateForm:FormGroup
  ImageUrl: any;
  fileData: any;
  isLoading: boolean;
  IsAdd:boolean = false
  Id: any;
  ImageId: any;
  ShowImage: any;
  constructor(private service: CommonService, private _noti: NotificationsService,private fb:FormBuilder) { }
ngOnInit(): void {
  this.GetWalthroughData()
  this.SplashUpdateForm = this.fb.group({
    title:['',[Validators.required,Validators.maxLength(50)]],
    description:['',[Validators.required,Validators.maxLength(50)]],
 })
}
Openmodal(){

  this.IsAdd = true
  this.ImageUrl = undefined
  this.isLoading = false
  this.SplashUpdateForm.reset()
$('#editsplashscreen').modal('show')
}
GetWalthroughData(){
  	this.service.get('splash-screen/get-all-sreens/').subscribe((res: any) => {
      console.log('Get',res);
       this.userInfo = res.data;
			 this.splash = res.data
  	})
}
GetWalkByID(id){
  this.service.get(`get-splash-screen-by-id/${id}/`).subscribe((res: any) => {
    console.log('Get',res);
     this.ImageId = res?.data?.image?.id;
  })
}
UpdateSplash(data){
  this.IsAdd = false
  this.isLoading = false
  this.Id = data?.id 
  this.GetWalkByID(this.Id)
$('#editsplashscreen').modal('show')
this.ImageUrl = this.imgUrl+data?.image
this.SplashUpdateForm.patchValue({
  title: data?.title,
  description:data?.description,
})
}
OpenImage(img){
  this.ShowImage = img
  $('#openImage').modal('show')
}
sendFile(fileData) {
  let formdata = new FormData()
  formdata.append('media', fileData);
  this.service.uploadMedia(formdata).subscribe((res: any) => {
    if (res.code == 200) {
      
      this.ImageId = res.data[0].id
    }
  });
}
uploadFile(event) {
  
  if (event.target.files && event.target.files[0]) {
    var type = event.target.files[0].type;
    var reader = new FileReader();
    reader.readAsDataURL(event.target.files[0]);
    if (type === 'image/png' || type === 'image/jpg' || type === 'image/jpeg') {
      let fileData = event.target.files[0];
      this.fileData = fileData;
      this.sendFile(fileData)
      reader.onload = (event) => { // called once readAsDataURL is completed
        this.ImageUrl = event.target.result;
      }
    }
  }
}
Update(){
  console.log('Upadte called');
 if(this.SplashUpdateForm.valid){
  this.isLoading = true
  let obj = {
    "title":this.SplashUpdateForm.controls.title.value,
    "description":this.SplashUpdateForm.controls.description.value,
    "image":this.ImageId
  }
  this.updateFn(obj)
  }else{
    this.SplashUpdateForm.markAllAsTouched()
  }
}
updateFn(obj) {
  console.log("OBJ",obj);
  this.service.put(`splash-screen/${this.Id}/`, obj).subscribe((res:any) => {
    if(res.code==200){
      this._noti.show("success", "Spalsh updated successfully.", "Success!");
      $('#editsplashscreen').modal('hide')
      this.GetWalthroughData()
       this.isLoading = false;
     
    }
  }, _ => {
    this.isLoading = false
  })
}
// AddSplash(){
//   if(this.files){
//    
//    if(this.SplashUpdateForm.valid){
//       console.log('Not undefined && Valid');
//       this.isLoading = true
//       // this.AddFn()
//       }else{
//         this.SplashUpdateForm.markAllAsTouched()
//       }
//   }else{
//     this._noti.show("error", "Please upload image.", "Failed");
// console.log('Not file');

//   }
   
// }
// AddFn() {
//   let obj = {
//     "title":this.SplashUpdateForm.controls.title.value.trim(),
//     "description":this.SplashUpdateForm.controls.description.value.trim(),
//     
//   }
//   this.service.post(`splash-screen/create/`, obj).subscribe((res:any) => {
//     if(res.code==200){
//       this._noti.show("success", "Spalsh screen added successfully.", "Success!");
//       $('#editsplashscreen').modal('hide')
//       this.GetWalthroughData()
//        this.isLoading = false;
      
//     }
//   }, _ => {
//     this.isLoading = false
//   })
// }

}
